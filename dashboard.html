<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Civic Dashboard with Interactive Map</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* A softer gray (slate-50) */
        }
        .header-gradient {
            background-size: 200% 200%;
            background-image: linear-gradient(to right, #f97316, #ea580c, #ef4444);
            animation: gradient-animation 8s ease infinite;
        }
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .issue-btn.selected {
            background-color: #fb923c; /* orange-400 */
            color: white;
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(251, 146, 60, 0.4);
            border-color: #fdba74; /* orange-300 */
        }
        .leaflet-container {
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        #notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(150%);
            padding: 12px 24px;
            border-radius: 9999px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.4s ease-in-out;
            z-index: 1000;
        }
        #notification.show {
            transform: translateX(-50%) translateY(0);
        }
        /* Custom scrollbar */
        #nearbyIssues::-webkit-scrollbar { width: 8px; }
        #nearbyIssues::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        #nearbyIssues::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        #nearbyIssues::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        .photo-preview-item { position: relative; }
        .remove-photo-btn {
            position: absolute; top: -5px; right: -5px;
            background-color: rgba(0,0,0,0.6); color: white;
            border: none; border-radius: 50%;
            width: 20px; height: 20px; font-size: 12px;
            font-weight: bold; line-height: 20px; text-align: center;
            cursor: pointer; transition: background-color 0.2s;
        }
        .remove-photo-btn:hover { background-color: rgba(239, 68, 68, 0.9); }

        /* Skeleton Loader for Issues */
        .skeleton-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .skeleton {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 0.25rem;
        }
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: .5; }
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <header class="header-gradient shadow-lg sticky top-0 z-50 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <h1 class="text-3xl font-bold tracking-tight">Citizen Dashboard</h1>
                <div class="text-right mt-2 md:mt-0">
                    <div class="flex items-center space-x-4">
                        <div class="language-selector">
                            <select id="languageSelect" aria-label="Select Language" class="bg-white/20 border-white/30 rounded-md text-sm p-1.5 focus:ring-white focus:border-white text-white">
                              <option value="en" class="text-black">English</option>
                              <option value="hi" class="text-black">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                              <option value="bn" class="text-black">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                              <option value="te" class="text-black">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                              <option value="mr" class="text-black">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                              <option value="ta" class="text-black">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                              <option value="gu" class="text-black">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
                              <option value="kn" class="text-black">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                              <option value="ml" class="text-black">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                              <option value="or" class="text-black">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
                            </select>
                        </div>
                        <a href="home.html" class="text-sm font-semibold hover:underline">‚¨Ö Home</a>
                        <a href="#" id="logoutBtn" class="text-sm font-semibold hover:underline">Logout</a>
                    </div>
                    <div id="datetime" class="text-xs font-medium text-orange-100 mt-1 text-center md:text-right"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="mb-8 bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="stateSelect" class="block text-sm font-medium text-gray-700" data-translate-key="selectState">Select State</label>
                    <select id="stateSelect" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                      <option value="" data-translate-key="selectStateOption">--Select State--</option>
                    </select>
                </div>
                <div>
                    <label for="districtSelect" class="block text-sm font-medium text-gray-700" data-translate-key="selectDistrict">Select District</label>
                    <select id="districtSelect" disabled class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-100 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                      <option value="" data-translate-key="selectDistrictOption">--Select District--</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-8">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 tracking-tight" data-translate-key="reportIssue">Report an Issue <span class="text-red-500">*</span></h2>
                    <form id="reportForm" aria-label="Report civic issue form">
                        <div id="issueCategories" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 mb-6">
    
    <button type="button" class="issue-btn border border-gray-200 bg-white hover:border-orange-400 p-3 rounded-lg flex flex-col items-center justify-center transition-all duration-300 transform hover:-translate-y-1" data-category="Pothole">
        <span class="text-3xl">üï≥Ô∏è</span>
        <span class="mt-2 text-xs text-center font-semibold">Pothole</span>
    </button>

    <button type="button" class="issue-btn border border-gray-200 bg-white hover:border-orange-400 p-3 rounded-lg flex flex-col items-center justify-center transition-all duration-300 transform hover:-translate-y-1" data-category="Waste Management">
        <span class="text-3xl">üóëÔ∏è</span>
        <span class="mt-2 text-xs text-center font-semibold">Garbage</span>
    </button>
    <button type="button" class="issue-btn border border-gray-200 bg-white hover:border-orange-400 p-3 rounded-lg flex flex-col items-center justify-center transition-all duration-300 transform hover:-translate-y-1" data-category="Waste Management">
        <span class="text-3xl">üóëÔ∏è‚¨ÜÔ∏è</span>
        <span class="mt-2 text-xs text-center font-semibold">Overflow</span>
    </button>
     <button type="button" class="issue-btn border border-gray-200 bg-white hover:border-orange-400 p-3 rounded-lg flex flex-col items-center justify-center transition-all duration-300 transform hover:-translate-y-1" data-category="Waste Management">
        <span class="text-3xl">üöÆ</span>
        <span class="mt-2 text-xs text-center font-semibold">Dumping</span>
    </button>

    <button type="button" class="issue-btn border border-gray-200 bg-white hover:border-orange-400 p-3 rounded-lg flex flex-col items-center justify-center transition-all duration-300 transform hover:-translate-y-1" data-category="Broken Streetlight">
        <span class="text-3xl">üí°</span>
        <span class="mt-2 text-xs text-center font-semibold">Streetlight</span>
    </button>
    
    <button type="button" class="issue-btn border border-gray-200 bg-white hover:border-orange-400 p-3 rounded-lg flex flex-col items-center justify-center transition-all duration-300 transform hover:-translate-y-1" data-category="Water Leakage">
        <span class="text-3xl">üíß</span>
        <span class="mt-2 text-xs text-center font-semibold">Water Leak</span>
    </button>

    <button type="button" class="issue-btn border border-gray-200 bg-white hover:border-orange-400 p-3 rounded-lg flex flex-col items-center justify-center transition-all duration-300 transform hover:-translate-y-1" data-category="Traffic Signal Issue">
        <span class="text-3xl">üö¶</span>
        <span class="mt-2 text-xs text-center font-semibold">Traffic Signal</span>
    </button>
    
    <button type="button" class="issue-btn border border-gray-200 bg-white hover:border-orange-400 p-3 rounded-lg flex flex-col items-center justify-center transition-all duration-300 transform hover:-translate-y-1" data-category="Park Maintenance">
        <span class="text-3xl">üå≥</span>
        <span class="mt-2 text-xs text-center font-semibold">Park Issue</span>
    </button>

</div>
                        <input type="hidden" id="selectedCategory" name="issueCategory" required>
                        
                        <label for="issueDescription" class="block text-sm font-medium text-gray-700">Issue Description <span class="text-red-500">*</span></label>
                        <textarea id="issueDescription" name="issueDescription" rows="6" placeholder="Describe your issue, or generate one with AI after uploading photos." class="mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-orange-500 focus:border-orange-500" required></textarea>
                        
                        <label for="issuePhoto" class="mt-4 w-full cursor-pointer rounded-lg border-2 border-dashed border-gray-300 bg-slate-50 p-6 text-center hover:border-orange-400 hover:bg-orange-50 transition-colors block">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                            <span class="mt-2 block text-sm font-medium text-gray-900" data-translate-key="uploadPhotoText">Click to upload photo(s) (Max 5)</span>
                        </label>
                        <input type="file" accept="image/*" capture="environment" id="issuePhoto" name="issuePhoto" class="hidden" multiple/>
                        <div id="photoPreview" class="mt-4 flex flex-wrap gap-2"></div>
                        <button 
                            type="button" 
                            id="generateDescBtn" 
                            class="mt-2 px-4 py-2 rounded bg-orange-500 text-white font-semibold hover:bg-orange-600 transition-colors">
                            ‚ú® Generate AI Description
                    </button>
                        
                        <!-- AI Description Button and Suggestion Box removed -->
                         
                        <div class="relative mt-4 p-4 border rounded-lg bg-slate-50">
                            <h3 class="text-lg font-semibold mb-2" data-translate-key="setLocation">Set Location</h3>
                            <div class="mb-3">
                                <label for="fullAddress" class="block text-sm font-medium text-gray-700" data-translate-key="fullAddress">Full Address <span class="text-red-500">*</span></label>
                                <input type="text" id="fullAddress" name="fullAddress" class="mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Type address and press Enter, or drag pin on map" required />
                            </div>
                            <div class="absolute top-16 right-2 z-[401] flex flex-col space-y-2">
                                <button type="button" id="locateMeBtn" class="bg-white p-2 rounded-full shadow-md hover:bg-gray-100 transition-colors" title="Center on my location">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>
                                </button>
                                <button type="button" id="resetMapBtn" class="bg-white p-2 rounded-full shadow-md hover:bg-gray-100 transition-colors" title="Reset Map">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h5M20 20v-5h-5M4 4l16 16" /></svg>
                                </button>
                            </div>

                            <p class="text-sm text-gray-600 mb-2" id="mapInstructions">
                               üó∫Ô∏è Type your address or drag the red pin to the correct place on the map.
                            </p>
                            <div id="map" class="w-full h-64 sm:h-80 rounded-lg border bg-gray-200"></div>
                            <div id="selectedAddress" class="mt-2 text-sm font-medium text-gray-700"></div>
                            <div id="coordsDisplay" class="mt-2 text-xs text-gray-500 text-center" data-translate-key="locationPin">Location Pin</div>
                            <input type="hidden" id="latitude" name="latitude" />
                            <input type="hidden" id="longitude" name="longitude" />
                        </div>

                        <button type="submit" class="mt-6 w-full py-3 px-4 text-base font-bold rounded-lg transition-all duration-300 header-gradient text-white shadow-lg hover:shadow-xl hover:scale-[1.02]" data-translate-key="submitReport">Submit Report</button>
                    </form>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                 <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold tracking-tight" data-translate-key="issuesNearYou">Issues Near You</h2>
                    <button id="summarizeIssuesBtn" class="text-sm font-semibold text-orange-600 hover:text-orange-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">‚ú® Summarize</button>
                </div>
                <div id="issuesSummary" class="hidden bg-orange-50 border-l-4 border-orange-400 text-orange-700 p-4 rounded-r-lg mb-4 text-sm"></div>
                <div id="nearbyIssues" aria-live="polite" class="overflow-y-auto max-h-[600px] pr-2 space-y-3">
                    </div>
            </div>
        </div>
    </main>
    <div id="notification"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Inject dummy reports into localStorage if none exist ---
        // Ensure dummy reports exist if none are saved
        if (!localStorage.getItem("reports") || JSON.parse(localStorage.getItem("reports")).length === 0) {
            const dummyReports = [
                {
                    issueCategory: "Pothole",
                    issueDescription: "Big pothole on the main road causing traffic jams.",
                    state: "Delhi",
                    district: "Central Delhi",
                    trackingId: "REP-20250920-PO001",
                    status: "pending",
                    latitude: "28.6562",
                    longitude: "77.2167",
                    photos: [
                        { name: "pothole.jpg", dataUrl: "https://via.placeholder.com/400x250?text=Pothole" }
                    ],
                    timestamp: new Date().toISOString()
                },
                {
                    issueCategory: "Garbage",
                    issueDescription: "Overflowing garbage bin near market area.",
                    state: "Maharashtra",
                    district: "Mumbai",
                    trackingId: "REP-20250920-GB002",
                    status: "inprogress",
                    latitude: "19.0760",
                    longitude: "72.8777",
                    photos: [
                        { name: "garbage.jpg", dataUrl: "https://via.placeholder.com/400x250?text=Garbage" }
                    ],
                    timestamp: new Date().toISOString()
                },
                {
                    issueCategory: "Streetlight",
                    issueDescription: "Streetlight not working for the past week.",
                    state: "Karnataka",
                    district: "Bengaluru Urban",
                    trackingId: "REP-20250920-SL003",
                    status: "resolved",
                    latitude: "12.9716",
                    longitude: "77.5946",
                    photos: [
                        { name: "streetlight.jpg", dataUrl: "https://via.placeholder.com/400x250?text=Streetlight" }
                    ],
                    timestamp: new Date().toISOString()
                }
            ];
            localStorage.setItem("reports", JSON.stringify(dummyReports));
        }
        // --- DOM ELEMENTS ---
        const datetimeDiv = document.getElementById('datetime');
        const reportForm = document.getElementById('reportForm');
        const issueButtons = document.querySelectorAll('.issue-btn');
        const selectedCategoryInput = document.getElementById('selectedCategory');
        const nearbyIssuesDiv = document.getElementById('nearbyIssues');
        const issueDescription = document.getElementById('issueDescription');
        const issuePhotoInput = document.getElementById('issuePhoto');
        const photoPreview = document.getElementById('photoPreview');
        const logoutBtn = document.getElementById('logoutBtn');
        const notificationDiv = document.getElementById('notification');
        const fullAddressInput = document.getElementById('fullAddress');
        const selectedAddressDiv = document.getElementById('selectedAddress');
        const coordsDisplay = document.getElementById('coordsDisplay');
        const latitudeInput = document.getElementById('latitude');
        const longitudeInput = document.getElementById('longitude');
        const locateMeBtn = document.getElementById('locateMeBtn');
        const resetMapBtn = document.getElementById('resetMapBtn');
        const stateSelect = document.getElementById('stateSelect');
        const districtSelect = document.getElementById('districtSelect');
        const languageSelect = document.getElementById('languageSelect');
        const summarizeIssuesBtn = document.getElementById('summarizeIssuesBtn');
        const issuesSummaryDiv = document.getElementById('issuesSummary');

        // --- MAP & LOCATION VARIABLES ---
        let map;
        let marker;
        const INDIA_CENTER_COORDS = [22.5937, 78.9629]; 
        const INDIA_WIDE_ZOOM = 5;
        let uploadedFiles = [];
        // For new upload/AI flow:
        let currentUpload = null;
        let nearbyIssuesData = [];

        // --- MOCK DATA ---
        const reportedIssues = [
            { id: 1, category: 'Potholes', description: 'Deep pothole on main road', lat: 12.9716, lon: 77.5946, status: 'reported' },
            { id: 2, category: 'Garbage', description: 'Overflowing bin near park', lat: 12.9720, lon: 77.5950, status: 'inprogress' },
            { id: 3, category: 'Streetlights', description: 'Streetlight not working for a week', lat: 12.9700, lon: 77.5930, status: 'resolved' },
            { id: 4, category: 'Water Leak', description: 'Pipe broken, clean water wasted', lat: 12.9695, lon: 77.5962, status: 'reported' }
        ];

        // --- TRANSLATION DATA ---
        const translations = {
            'hi': {
                'reportIssue': '‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
                'pothole': '‡§ó‡§°‡•ç‡§¢‡§æ',
                'garbage': '‡§ï‡§ö‡§∞‡§æ',
                'streetlights': '‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ü‡§≤‡§æ‡§á‡§ü',
                'waterLeak': '‡§™‡§æ‡§®‡•Ä ‡§ï‡§æ ‡§∞‡§ø‡§∏‡§æ‡§µ',
                'overflow': '‡§ì‡§µ‡§∞‡§´‡•ç‡§≤‡•ã',
                'dumping': '‡§Ö‡§µ‡•à‡§ß ‡§°‡§Ç‡§™‡§ø‡§Ç‡§ó',
                'encroachment': '‡§Ö‡§§‡§ø‡§ï‡•ç‡§∞‡§Æ‡§£',
                'damage': '‡§ï‡•ç‡§∑‡§§‡§ø',
                'drains': '‡§®‡§æ‡§≤‡§ø‡§Ø‡§æ‡§Ç',
                'sewage': '‡§∏‡•Ä‡§µ‡•á‡§ú',
                'powerOutage': '‡§¨‡§ø‡§ú‡§≤‡•Ä ‡§ï‡§ü‡•å‡§§‡•Ä',
                'toilets': '‡§∂‡•å‡§ö‡§æ‡§≤‡§Ø',
                'dangerZone': '‡§ñ‡§§‡§∞‡§®‡§æ‡§ï ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞',
                'other': '‡§Ö‡§®‡•ç‡§Ø',
                'uploadPhotoText': '‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç (‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 5)',
                'setLocation': '‡§∏‡•ç‡§•‡§æ‡§® ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                'fullAddress': '‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ',
                'locationPin': '‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§ø‡§®',
                'submitReport': '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç',
                'issuesNearYou': '‡§Ü‡§™‡§ï‡•á ‡§Ü‡§∏-‡§™‡§æ‡§∏ ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§è‡§Ç',
                'selectState': '‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç',
                'selectDistrict': '‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç',
                'selectStateOption': '--‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç--',
                'selectDistrictOption': '--‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç--',
                'profile': '‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤',
                'logout': '‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü',
            },
            // Add other languages here...
        };

        const stateDistrictData = {
            "Andaman and Nicobar Islands": ["Nicobar", "North and Middle Andaman", "South Andaman"],
            "Andhra Pradesh": ["Alluri Sitharama Raju", "Anakapalli", "Ananthapuramu", "Annamayya", "Bapatla", "Chittoor", "Dr. B.R. Ambedkar Konaseema", "East Godavari", "Eluru", "Guntur", "Kakinada", "Krishna", "Kurnool", "Nandyal", "NTR", "Palnadu", "Parvathipuram Manyam", "Prakasam", "SPS Nellore", "Sri Sathya Sai", "Srikakulam", "Tirupati", "Visakhapatnam", "Vizianagaram", "West Godavari", "YSR Kadapa"],
            "Arunachal Pradesh": ["Anjaw", "Changlang", "Dibang Valley", "East Kameng", "East Siang", "Kamle", "Kra Daadi", "Kurung Kumey", "Lepa Rada", "Lohit", "Longding", "Lower Dibang Valley", "Lower Siang", "Lower Subansiri", "Namsai", "Pakke Kessang", "Papum Pare", "Shi Yomi", "Siang", "Tawang", "Tirap", "Upper Siang", "Upper Subansiri", "West Kameng", "West Siang"],
            "Assam": ["Bajali", "Baksa", "Barpeta", "Biswanath", "Bongaigaon", "Cachar", "Charaideo", "Chirang", "Darrang", "Dhemaji", "Dhubri", "Dibrugarh", "Dima Hasao", "Goalpara", "Golaghat", "Hailakandi", "Hojai", "Jorhat", "Kamrup", "Kamrup Metropolitan", "Karbi Anglong", "Karimganj", "Kokrajhar", "Lakhimpur", "Majuli", "Morigaon", "Nagaon", "Nalbari", "Sivasagar", "Sonitpur", "South Salmara-Mankachar", "Tamulpur", "Tinsukia", "Udalguri", "West Karbi Anglong"],
            "Bihar": ["Araria", "Arwal", "Aurangabad", "Banka", "Begusarai", "Bhagalpur", "Bhojpur", "Buxar", "Darbhanga", "East Champaran", "Gaya", "Gopalganj", "Jamui", "Jehanabad", "Kaimur", "Katihar", "Khagaria", "Kishanganj", "Lakhisarai", "Madhepura", "Madhubani", "Munger", "Muzaffarpur", "Nalanda", "Nawada", "Patna", "Purnia", "Rohtas", "Saharsa", "Samastipur", "Saran", "Sheikhpura", "Sheohar", "Sitamarhi", "Siwan", "Supaul", "Vaishali", "West Champaran"],
            "Chandigarh": ["Chandigarh"],
            "Chhattisgarh": ["Balod", "Baloda Bazar", "Balrampur", "Bastar", "Bemetara", "Bijapur", "Bilaspur", "Dantewada", "Dhamtari", "Durg", "Gariaband", "Gaurela Pendra Marwahi", "Janjgir-Champa", "Jashpur", "Kabirdham", "Kanker", "Khairagarh-Chhuikhadan-Gandai", "Kondagaon", "Korba", "Koriya", "Mahasamund", "Manendragarh-Chirmiri-Bharatpur", "Mohla-Manpur-Ambagarh Chowki", "Mungeli", "Narayanpur", "Raigarh", "Raipur", "Rajnandgaon", "Sarangarh-Bilaigarh", "Sakti", "Sukma", "Surajpur", "Surguja"],
            "Dadra and Nagar Haveli and Daman and Diu": ["Daman", "Diu", "Dadra and Nagar Haveli"],
            "Delhi": ["Central Delhi", "East Delhi", "New Delhi", "North Delhi", "North East Delhi", "North West Delhi", "Shahdara", "South Delhi", "South East Delhi", "South West Delhi", "West Delhi"],
            "Goa": ["North Goa", "South Goa"],
            "Gujarat": ["Ahmedabad", "Amreli", "Anand", "Aravalli", "Banaskantha", "Bharuch", "Bhavnagar", "Botad", "Chhota Udaipur", "Dahod", "Dang", "Devbhoomi Dwarka", "Gandhinagar", "Gir Somnath", "Jamnagar", "Junagadh", "Kheda", "Kutch", "Mahisagar", "Mehsana", "Morbi", "Narmada", "Navsari", "Panchmahal", "Patan", "Porbandar", "Rajkot", "Sabarkantha", "Surat", "Surendranagar", "Tapi", "Vadodara", "Valsad"],
            "Haryana": ["Ambala", "Bhiwani", "Charkhi Dadri", "Faridabad", "Fatehabad", "Gurugram", "Hisar", "Jhajjar", "Jind", "Kaithal", "Karnal", "Kurukshetra", "Mahendragarh", "Nuh", "Palwal", "Panchkula", "Panipat", "Rewari", "Rohtak", "Sirsa", "Sonipat", "Yamunanagar"],
            "Himachal Pradesh": ["Bilaspur", "Chamba", "Hamirpur", "Kangra", "Kinnaur", "Kullu", "Lahaul and Spiti", "Mandi", "Shimla", "Sirmaur", "Solan", "Una"],
            "Jammu and Kashmir": ["Anantnag", "Bandipora", "Baramulla", "Budgam", "Doda", "Ganderbal", "Jammu", "Kathua", "Kishtwar", "Kulgam", "Kupwara", "Poonch", "Pulwama", "Rajouri", "Ramban", "Reasi", "Samba", "Shopian", "Srinagar", "Udhampur"],
            "Jharkhand": ["Bokaro", "Chatra", "Deoghar", "Dhanbad", "Dumka", "East Singhbhum", "Garhwa", "Giridih", "Godda", "Gumla", "Hazaribagh", "Jamtara", "Khunti", "Koderma", "Latehar", "Lohardaga", "Pakur", "Palamu", "Ramgarh", "Ranchi", "Sahebganj", "Seraikela Kharsawan", "Simdega", "West Singhbhum"],
            "Karnataka": ["Bagalkot", "Ballari", "Belagavi", "Bengaluru Rural", "Bengaluru Urban", "Bidar", "Chamarajanagar", "Chikkaballapur", "Chikkamagaluru", "Chitradurga", "Dakshina Kannada", "Davanagere", "Dharwad", "Gadag", "Hassan", "Haveri", "Kalaburagi", "Kodagu", "Kolar", "Koppal", "Mandya", "Mysuru", "Raichur", "Ramanagara", "Shivamogga", "Tumakuru", "Udupi", "Uttara Kannada", "Vijayanagara", "Vijayapura", "Yadgir"],
            "Kerala": ["Alappuzha", "Ernakulam", "Idukki", "Kannur", "Kasaragod", "Kollam", "Kottayam", "Kozhikode", "Malappuram", "Palakkad", "Pathanamthitta", "Thiruvananthapuram", "Thrissur", "Wayanad"],
            "Ladakh": ["Kargil", "Leh"],
            "Lakshadweep": ["Lakshadweep"],
            "Madhya Pradesh": ["Agar Malwa", "Alirajpur", "Anuppur", "Ashoknagar", "Balaghat", "Barwani", "Betul", "Bhind", "Bhopal", "Burhanpur", "Chhatarpur", "Chhindwara", "Damoh", "Datia", "Dewas", "Dhar", "Dindori", "Guna", "Gwalior", "Harda", "Indore", "Jabalpur", "Jhabua", "Katni", "Khandwa", "Khargone", "Maihar", "Mandla", "Mandsaur", "Mauganj", "Morena", "Narmadapuram", "Narsinghpur", "Neemuch", "Niwari", "Pachmarhi", "Pandhurna", "Panna", "Raisen", "Rajgarh", "Ratlam", "Rewa", "Sagar", "Satna", "Sehore", "Seoni", "Shahdol", "Shajapur", "Sheopur", "Shivpuri", "Sidhi", "Singrauli", "Tikamgarh", "Ujjain", "Umaria", "Vidisha"],
            "Maharashtra": ["Ahmednagar", "Akola", "Amravati", "Aurangabad", "Beed", "Bhandara", "Buldhana", "Chandrapur", "Dhule", "Gadchiroli", "Gondia", "Hingoli", "Jalgaon", "Jalna", "Kolhapur", "Latur", "Mumbai City", "Mumbai Suburban", "Nagpur", "Nanded", "Nandurbar", "Nashik", "Osmanabad", "Palghar", "Parbhani", "Pune", "Raigad", "Ratnagiri", "Sangli", "Satara", "Sindhudurg", "Solapur", "Thane", "Wardha", "Washim", "Yavatmal"],
            "Manipur": ["Bishnupur", "Chandel", "Churachandpur", "Imphal East", "Imphal West", "Jiribam", "Kakching", "Kamjong", "Kangpokpi", "Noney", "Pherzawl", "Senapati", "Tamenglong", "Tengnoupal", "Thoubal", "Ukhrul"],
            "Meghalaya": ["East Garo Hills", "East Jaintia Hills", "East Khasi Hills", "North Garo Hills", "Ri Bhoi", "South Garo Hills", "South West Garo Hills", "South West Khasi Hills", "West Garo Hills", "West Jaintia Hills", "West Khasi Hills"],
            "Mizoram": ["Aizawl", "Champhai", "Hnahthial", "Khawzawl", "Kolasib", "Lawngtlai", "Lunglei", "Mamit", "Saiha", "Saitual", "Serchhip"],
            "Nagaland": ["Ch√ºmoukedima", "Dimapur", "Kiphire", "Kohima", "Longleng", "Mokokchung", "Mon", "Niuland", "Noklak", "Peren", "Phek", "Shamator", "Tseminy√º", "Tuensang", "Wokha", "Zunheboto"],
            "Odisha": ["Angul", "Balangir", "Balasore", "Bargarh", "Bhadrak", "Boudh", "Cuttack", "Deogarh", "Dhenkanal", "Gajapati", "Ganjam", "Jagatsinghpur", "Jajpur", "Jharsuguda", "Kalahandi", "Kandhamal", "Kendrapara", "Kendujhar", "Khordha", "Koraput", "Malkangiri", "Mayurbhanj", "Nabarangpur", "Nayagarh", "Nuapada", "Puri", "Rayagada", "Sambalpur", "Sonepur", "Sundargarh"],
            "Puducherry": ["Karaikal", "Mahe", "Puducherry", "Yanam"],
            "Punjab": ["Amritsar", "Barnala", "Bathinda", "Faridkot", "Fatehgarh Sahib", "Fazilka", "Ferozepur", "Gurdaspur", "Hoshiarpur", "Jalandhar", "Kapurthala", "Ludhiana", "Malerkotla", "Mansa", "Moga", "Pathankot", "Patiala", "Rupnagar", "Sahibzada Ajit Singh Nagar", "Sangrur", "Shaheed Bhagat Singh Nagar", "Sri Muktsar Sahib", "Tarn Taran"],
            "Rajasthan": ["Ajmer", "Alwar", "Anupgarh", "Balotra", "Banswara", "Baran", "Barmer", "Beawar", "Bharatpur", "Bhilwara", "Bikaner", "Bundi", "Chittorgarh", "Churu", "Dausa", "Deeg", "Dholpur", "Didwana-Kuchaman", "Dungarpur", "Ganganagar", "Gangapur City", "Hanumangarh", "Jaipur", "Jaipur Rural", "Jaisalmer", "Jalore", "Jhalawar", "Jhunjhunu", "Jodhpur", "Jodhpur Rural", "Karauli", "Kekri", "Khairthal-Tijara", "Kota", "Kotputli-Behror", "Nagaur", "Neem Ka Thana", "Pali", "Phalodi", "Pratapgarh", "Rajsamand", "Salumbar", "Sanchore", "Sawai Madhopur", "Shahpura", "Sikar", "Sirohi", "Tonk", "Udaipur"],
            "Sikkim": ["East Sikkim", "North Sikkim", "Pakyong", "Soreng", "South Sikkim", "West Sikkim"],
            "Tamil Nadu": ["Ariyalur", "Chengalpattu", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri", "Dindigul", "Erode", "Kallakurichi", "Kancheepuram", "Kanyakumari", "Karur", "Krishnagiri", "Madurai", "Mayiladuthurai", "Nagapattinam", "Namakkal", "Nilgiris", "Perambalur", "Pudukkottai", "Ramanathapuram", "Ranipet", "Salem", "Sivaganga", "Tenkasi", "Thanjavur", "Theni", "Thoothukudi", "Tiruchirappalli", "Tirunelveli", "Tirupathur", "Tiruppur", "Tiruvallur", "Tiruvannamalai", "Tiruvarur", "Vellore", "Viluppuram", "Virudhunagar"],
            "Telangana": ["Adilabad", "Bhadradri Kothagudem", "Hanamkonda", "Hyderabad", "Jagitial", "Jangaon", "Jayashankar Bhupalpally", "Jogulamba Gadwal", "Kamareddy", "Karimnagar", "Khammam", "Komaram Bheem", "Mahabubabad", "Mahabubnagar", "Mancherial", "Medak", "Medchal-Malkajgiri", "Mulugu", "Nagarkurnool", "Nalgonda", "Narayanpet", "Nirmal", "Nizamabad", "Peddapalli", "Rajanna Sircilla", "Ranga Reddy", "Sangareddy", "Siddipet", "Suryapet", "Vikarabad", "Wanaparthy", "Warangal", "Yadadri Bhuvanagiri"],
            "Tripura": ["Dhalai", "Gomati", "Khowai", "North Tripura", "Sepahijala", "South Tripura", "Unakoti", "West Tripura"],
            "Uttar Pradesh": ["Agra", "Aligarh", "Ambedkar Nagar", "Amethi", "Amroha", "Auraiya", "Ayodhya", "Azamgarh", "Baghpat", "Bahraich", "Ballia", "Balrampur", "Banda", "Barabanki", "Bareilly", "Basti", "Bhadohi", "Bijnor", "Budaun", "Bulandshahr", "Chandauli", "Chitrakoot", "Deoria", "Etah", "Etawah", "Farrukhabad", "Fatehpur", "Firozabad", "Gautam Buddh Nagar", "Ghaziabad", "Ghazipur", "Gonda", "Gorakhpur", "Hamirpur", "Hapur", "Hardoi", "Hathras", "Jalaun", "Jaunpur", "Jhansi", "Kannauj", "Kanpur Dehat", "Kanpur Nagar", "Kasganj", "Kaushambi", "Kheri", "Kushinagar", "Lalitpur", "Lucknow", "Maharajganj", "Mahoba", "Mainpuri", "Mathura", "Mau", "Meerut", "Mirzapur", "Moradabad", "Muzaffarnagar", "Pilibhit", "Pratapgarh", "Prayagraj", "Raebareli", "Rampur", "Saharanpur", "Sambhal", "Sant Kabir Nagar", "Shahjahanpur", "Shamli", "Shravasti", "Siddharthnagar", "Sitapur", "Sonbhadra", "Sultanpur", "Unnao", "Varanasi"],
            "Uttarakhand": ["Almora", "Bageshwar", "Chamoli", "Champawat", "Dehradun", "Haridwar", "Nainital", "Pauri Garhwal", "Pithoragarh", "Rudraprayag", "Tehri Garhwal", "Udham Singh Nagar", "Uttarkashi"],
            "West Bengal": ["Alipurduar", "Bankura", "Birbhum", "Cooch Behar", "Dakshin Dinajpur", "Darjeeling", "Hooghly", "Howrah", "Jalpaiguri", "Jhargram", "Kalimpong", "Kolkata", "Malda", "Murshidabad", "Nadia", "North 24 Parganas", "Paschim Bardhaman", "Paschim Medinipur", "Purba Bardhaman", "Purba Medinipur", "Purulia", "South 24 Parganas", "Uttar Dinajpur"]
        };


        // --- UTILITY FUNCTIONS ---
        const updateDateTime = () => {
            datetimeDiv.textContent = new Date().toLocaleString('en-IN', { dateStyle: 'full', timeStyle: 'medium' });
        };
        
        const showNotification = (message, type = 'success') => {
            let bgColor = 'bg-green-500';
            if (type === 'error') bgColor = 'bg-red-500';
            if (type === 'info') bgColor = 'bg-blue-500';
            
            notificationDiv.textContent = message;
            notificationDiv.className = `fixed bottom-5 left-1/2 -translate-x-1/2 p-4 rounded-lg text-white ${bgColor} shadow-lg transition-transform duration-300 transform show`;
            
            setTimeout(() => {
                notificationDiv.classList.remove('show');
            }, 3000);
        };

        const calculateDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Distance in km
        };

        const updateUIWithTranslations = (lang) => {
            if (!translations[lang]) return;
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        };

        // --- CORE FUNCTIONS ---
        const populateStates = () => {
            const states = Object.keys(stateDistrictData).sort();
            states.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateSelect.appendChild(option);
            });
        };
        
        const populateDistricts = (state) => {
            districtSelect.innerHTML = '<option value="">--Select District--</option>';
            if (state && stateDistrictData[state]) {
                districtSelect.disabled = false;
                districtSelect.classList.remove('bg-gray-100');
                stateDistrictData[state].sort().forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            } else {
                districtSelect.disabled = true;
                 districtSelect.classList.add('bg-gray-100');
            }
        };

        const initMap = (center, zoom) => {
            if (map) map.remove();
            map = L.map('map').setView(center, zoom);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            marker = L.marker(center, { draggable: true }).addTo(map);
            marker.on('dragend', (event) => {
                const position = marker.getLatLng();
                updateLocationDetails(position.lat, position.lng);
            });
            updateLocationDetails(center[0], center[1]);
        };

        const locateUser = () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    map.setView([latitude, longitude], 15);
                    marker.setLatLng([latitude, longitude]);
                    updateLocationDetails(latitude, longitude);
                    fetchNearbyIssues(latitude, longitude);
                    showNotification('Location found!', 'success');
                }, () => {
                    showNotification('Could not access your location. Please enable location services.', 'error');
                    fetchNearbyIssues(INDIA_CENTER_COORDS[0], INDIA_CENTER_COORDS[1]); // Fetch for default location
                });
            } else {
                showNotification('Geolocation is not supported by this browser.', 'error');
                fetchNearbyIssues(INDIA_CENTER_COORDS[0], INDIA_CENTER_COORDS[1]); // Fetch for default location
            }
        };

        const updateLocationDetails = async (lat, lng) => {
            latitudeInput.value = lat;
            longitudeInput.value = lng;
            coordsDisplay.textContent = `Lat: ${lat.toFixed(5)}, Lon: ${lng.toFixed(5)}`;
            
            // Fetch address from coordinates (reverse geocoding)
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
                const data = await response.json();
                if (data && data.display_name) {
                    const address = data.display_name;
                    fullAddressInput.value = address;
                    selectedAddressDiv.textContent = `Selected: ${address}`;
                }
            } catch (error) {
                console.error("Reverse geocoding failed:", error);
                selectedAddressDiv.textContent = 'Could not fetch address.';
            }
            fetchNearbyIssues(lat, lng);
        };
        
        function fetchNearbyIssues(lat, lon) {
            // Show skeleton loader immediately
            nearbyIssuesDiv.innerHTML = `
                <div class="skeleton-card space-y-3">
                    <div class="flex justify-between items-center">
                        <div class="skeleton h-4 w-2/5"></div>
                        <div class="skeleton h-5 w-1/4"></div>
                    </div>
                    <div class="skeleton h-3 w-full"></div>
                    <div class="skeleton h-3 w-3/4"></div>
                    <div class="skeleton h-2 w-1/3 mt-1"></div>
                </div>
                <div class="skeleton-card space-y-3">
                    <div class="flex justify-between items-center">
                        <div class="skeleton h-4 w-1/3"></div>
                        <div class="skeleton h-5 w-1/4"></div>
                    </div>
                    <div class="skeleton h-3 w-full"></div>
                    <div class="skeleton h-3 w-5/6"></div>
                    <div class="skeleton h-2 w-1/4 mt-1"></div>
                </div>
            `;
            nearbyIssuesDiv.dataset.loading = "true";


            // Simulate network delay to see the loader
            setTimeout(() => {
                const nearby = reportedIssues.map(issue => ({
                    ...issue,
                    distance: calculateDistance(lat, lon, issue.lat, issue.lon)
                })).filter(issue => issue.distance <= 5).sort((a, b) => a.distance - b.distance);
                
                nearbyIssuesData = nearby;
                delete nearbyIssuesDiv.dataset.loading;
                displayIssues(nearby);
                summarizeIssuesBtn.disabled = nearby.length === 0;
            }, 800); // 800ms delay
        }
        
        function displayIssues(issues) {
            nearbyIssuesDiv.innerHTML = ''; // Clear previous content

            // Show skeleton loader if issues array is not yet populated
            if (issues.length === 0) {
                // Show a "No issues found" message if the nearbyIssuesData is confirmed empty
                if (nearbyIssuesData.length === 0 && !nearbyIssuesDiv.dataset.loading) {
                     nearbyIssuesDiv.innerHTML = `<div class="text-center text-gray-500 py-8">No issues found within 5km of pin.</div>`;
                }
                return;
            }
            
            issues.forEach(issue => {
                let statusColor, statusBorderColor;
                switch (issue.status) {
                    case 'resolved': 
                        statusColor = 'bg-green-100 text-green-800'; 
                        statusBorderColor = 'border-green-300';
                        break;
                    case 'inprogress': 
                        statusColor = 'bg-blue-100 text-blue-800'; 
                        statusBorderColor = 'border-blue-300';
                        break;
                    default: 
                        statusColor = 'bg-yellow-100 text-yellow-800';
                        statusBorderColor = 'border-yellow-300';
                }
                const issueCard = `
                    <div class="p-4 bg-white border ${statusBorderColor} rounded-lg shadow-sm hover:shadow-lg hover:border-orange-400 transition-all duration-300 cursor-pointer transform hover:-translate-y-1" onclick="window.dispatchEvent(new CustomEvent('panToIssue', { detail: { lat: ${issue.lat}, lon: ${issue.lon} } }))">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800 pr-2">${issue.category}</h3>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${statusColor} whitespace-nowrap">${issue.status}</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">${issue.description}</p>
                        <p class="text-xs text-gray-400 mt-2 font-medium">${issue.distance.toFixed(2)} km away</p>
                    </div>
                `;
                nearbyIssuesDiv.innerHTML += issueCard;
            });
        }


        // Long detailed descriptions per category (10‚Äì20 lines each, multiple variants)
        const longDescriptions = {
            "Pothole": [
                `A massive pothole has formed on the main road, spanning nearly three feet in diameter and several inches deep. This pothole disrupts the smooth flow of traffic and poses a significant risk to two-wheelers and smaller vehicles. During peak traffic hours, drivers swerve dangerously to avoid the hazard, increasing the likelihood of accidents. Rainwater often collects in the pothole, making it difficult for commuters to gauge its depth and worsening the risk. 

Residents have expressed frustration, stating that multiple complaints have been ignored by municipal authorities. Delivery vehicles and school buses frequently get delayed due to bottlenecks caused by this obstruction. Nighttime visibility makes the pothole even more dangerous, especially since there are no warning signs or barricades. Emergency vehicles face delays, which could prove critical in urgent situations. 

Local shopkeepers nearby report a decline in customers as drivers avoid the area. The prolonged existence of this pothole raises questions about the efficiency of road maintenance services. Continuous wear and tear from heavy trucks has further expanded the pothole, making it more hazardous with time. The longer this issue remains unresolved, the more costly and time-consuming the eventual repair will become. Residents are now demanding a long-term resurfacing of the road, not just patchwork fixes.`,
                `There are multiple potholes scattered across the road leading to the bus depot. Motorcyclists zigzag dangerously to avoid them, while four-wheelers frequently suffer tire damage. During rains, these potholes get filled with muddy water, making them invisible to unsuspecting commuters. The situation is especially critical for ambulances, which lose valuable time navigating these broken patches. 

Residents have staged several protests demanding immediate road repair, but no visible action has been taken. Many small businesses along this route complain of declining sales as delivery services refuse to enter the locality. Traffic jams are now routine, and school buses often arrive late. 

The continued neglect of these potholes is not just a minor inconvenience but a serious public safety hazard. Authorities are being accused of negligence, and public outrage is growing. If not addressed immediately, these potholes may lead to fatal accidents and long-term infrastructural damage.`,
                `The pothole near the community center has become so large that locals now refer to it as a ‚Äúcrater.‚Äù Vehicles often get stuck, and tow services are frequently called to rescue two-wheelers. Children walking to school are forced to walk on the busy main road to avoid the pothole, putting them in grave danger. Rainwater accumulation has made the area prone to mosquito breeding, raising concerns about diseases like dengue. 

Local shopkeepers claim that sales have dropped as customers refuse to risk their vehicles on this road. Despite repeated social media campaigns tagging civic authorities, no repair work has been initiated. Community activists argue that funds for road repair are being misused elsewhere. 

If not repaired soon, this pothole could damage underground pipelines and worsen flooding during rains. Residents are now organizing a signature campaign to escalate the issue further.`
            ],
            "Garbage": [
                `Overflowing garbage bins have become a daily sight in the marketplace. Waste is spilling over onto footpaths, creating both an eyesore and a health hazard. Flies and stray animals scatter the garbage further into the streets, making the area extremely unhygienic. 

The foul odor spreads into nearby shops, forcing business owners to keep doors shut throughout the day. Customers complain of nausea while passing by, and many prefer to shop elsewhere. Children walking home from school often step on rotting food waste, increasing the risk of infections. 

Residents are frustrated as repeated complaints to the sanitation department have gone unanswered. The rainy season has worsened the problem, with clogged drains leading to waterlogging. Pools of stagnant, garbage-filled water have become breeding grounds for mosquitoes. 

The neglect of proper waste disposal has now reached a point where urgent intervention is necessary. The situation is beginning to impact local trade and daily life heavily.`,
                `The garbage dump near the bus stand has grown steadily over the past month. Plastic, food waste, and hazardous materials are lying in the open, creating unbearable stench. Stray dogs and cows are constantly seen scavenging, spreading the waste across the road. 

During rush hour, the pile of garbage obstructs bus passengers from entering or exiting comfortably. Locals complain that the accumulation of waste has attracted rodents, increasing the risk of plague and other diseases. Shops in the area are losing customers as people avoid the unhygienic surroundings. 

Municipal staff have been informed multiple times, but no visible cleaning has been carried out. Community leaders warn that if the issue persists, it may lead to large-scale protests.`,
                `Uncollected garbage has piled up in the residential colony for nearly two weeks. Food waste, plastic bags, and construction debris are strewn across the streets. The stench makes it nearly impossible for residents to keep their windows open. 

Stray animals rummage through the piles, worsening the mess. Rainwater has turned the garbage heap into a sludge that blocks drains and causes flooding. Parents fear their children may fall sick due to the unhygienic environment. 

Despite repeated requests, garbage collection trucks have not arrived. The lack of response from authorities has eroded residents‚Äô trust in civic services.`
            ],
            "Streetlight": [
                `A key streetlight on the main residential road has been dysfunctional for nearly two weeks. As a result, the entire lane remains in complete darkness after sunset. The absence of lighting makes it dangerous for schoolchildren, women, and senior citizens. 

Local residents claim that cases of chain snatching and petty theft have increased due to the lack of illumination. Commuters on two-wheelers find it extremely difficult to navigate potholes and speed breakers in the dark. Heavy rainfall further worsens visibility, making accidents almost inevitable. 

Despite lodging multiple complaints, the electricity board has not taken any steps for repair. The issue has been raised in community meetings, but authorities continue to ignore the matter. Shopkeepers in the area say that customers avoid visiting after dark, impacting their sales drastically.`,
                `The entire stretch leading to the railway station has no functioning streetlights. This has resulted in numerous accidents, as drivers struggle to spot pedestrians in time. 

Many auto-rickshaw drivers refuse to take passengers through the area at night, citing safety risks. Residents report that crime incidents have increased significantly due to the lack of illumination. Several petitions have been filed demanding urgent repair, but no concrete steps have been taken. 

The road is one of the busiest in the city, making this issue even more pressing. The delay in fixing the streetlights has left residents angry and worried.`,
                `Multiple streetlights in the neighborhood park have stopped working. The park, which is usually bustling with children and senior citizens, now lies deserted after sunset. 

Parents feel unsafe allowing their children to play in the poorly lit park. Incidents of vandalism have increased, and residents have spotted suspicious activity in the evenings. The lack of adequate lighting also makes the park a potential hiding spot for criminals. 

Repeated appeals to the municipal corporation have gone unanswered. The once lively public space is now avoided by most locals.`
            ],
            "Water Leakage": [
                `A major water leakage from an underground pipeline near the park has been ongoing for over ten days. Thousands of liters of potable water are wasted daily, pooling onto the streets and damaging the road surface. Pedestrians and two-wheelers are frequently seen slipping on the wet surface. 

Locals are frustrated by the wastage at a time when the city is already facing water scarcity. The leakage has created large puddles, becoming a breeding ground for mosquitoes. Complaints have been made to the water supply department, but only temporary patchwork has been attempted. 

The leakage is so severe that small cracks have appeared on adjacent house walls due to constant moisture. Shopkeepers in the area complain of reduced foot traffic, as customers avoid walking on the slippery road. Children playing nearby are at constant risk of slipping and injuring themselves. 

The community has demanded a permanent solution rather than repeated temporary fixes.`,
                `A cracked water pipeline near the hospital has been leaking continuously, making the entrance road nearly unusable. Patients and ambulances face serious difficulty entering the hospital premises. Residents fear the leakage may lead to further damage, weakening the road foundation. 

The foul smell of stagnant water has spread into the hospital, creating an unhygienic environment for patients. Doctors have raised alarms about the risks of infection. Despite urgent complaints, no repair work has been carried out yet. 

This problem is not only about water wastage but also about public health and safety.`,
                `Water leakage from an overhead tank has resulted in constant dripping onto the street below. Over time, the leakage has eroded the road surface, forming potholes. Vehicles skid while braking suddenly, leading to several minor accidents. 

Residents have placed sandbags to divert the flow, but the problem persists. Stagnant water has become a breeding ground for insects, making evenings unbearable. Complaints on the civic helpline have gone unanswered. 

People fear that the structure of the tank may weaken if the leakage is not fixed immediately.`
            ]
        };

        // 1. Predefined descriptions for auto-fill
        const predefinedDescriptions = {
            "Pothole": "Large pothole creating traffic congestion and risk for vehicles.",
            "Garbage": "Garbage bins overflowing, causing unhygienic conditions in the area.",
            "Streetlight": "Streetlight not functioning at night, leading to unsafe conditions.",
            "Water Leakage": "Water leakage from pipeline causing wastage and road damage.",
            "Traffic Signal": "Traffic signal not working, causing confusion at junction."
        };

        // 2. Updated handleCategorySelect
        const handleCategorySelect = (button) => {
            issueButtons.forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            if (selectedCategoryInput) {
                selectedCategoryInput.value = button.dataset.category;
            }
            // No AI button to enable
            issueDescription.value = "";
            issueDescription.focus();
        };
        
        // Enhanced handlePhotoUpload: EXIF GPS extraction and AI button enable
        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files).slice(0, 5);
            uploadedFiles = [];
            photoPreview.innerHTML = "";
            // Enable/disable AI button
            if (files.length > 0) {
                generateDescBtn.disabled = false;
            } else {
                generateDescBtn.disabled = true;
            }
            let triedGeolocation = false;
            let exifLocationFound = false;
            files.forEach((file, idx) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileId = Date.now() + "_" + file.name;
                    const uploadObj = {
                        id: fileId,
                        name: file.name,
                        dataUrl: e.target.result
                    };
                    uploadedFiles.push(uploadObj);
                    const previewContainer = document.createElement('div');
                    previewContainer.className = 'photo-preview-item w-24 h-24';
                    previewContainer.innerHTML = `
                        <img src="${e.target.result}" class="w-full h-full object-cover rounded-md border"/>
                    `;
                    photoPreview.appendChild(previewContainer);
                };
                reader.readAsDataURL(file);
                // EXIF GPS extraction (only for the first file)
                if (idx === 0) {
                    const exifReader = new FileReader();
                    exifReader.onload = function(ev) {
                        try {
                            // Try to get GPS from File object
                            EXIF.getData(file, function() {
                                const gpsLat = EXIF.getTag(this, "GPSLatitude");
                                const gpsLatRef = EXIF.getTag(this, "GPSLatitudeRef");
                                const gpsLng = EXIF.getTag(this, "GPSLongitude");
                                const gpsLngRef = EXIF.getTag(this, "GPSLongitudeRef");
                                if (gpsLat && gpsLatRef && gpsLng && gpsLngRef) {
                                    function dmsToDecimal(dms, ref) {
                                        const [d, m, s] = dms;
                                        let dec = d + m/60 + s/3600;
                                        if (ref === "S" || ref === "W") dec = -dec;
                                        return dec;
                                    }
                                    const lat = dmsToDecimal(gpsLat, gpsLatRef);
                                    const lng = dmsToDecimal(gpsLng, gpsLngRef);
                                    exifLocationFound = true;
                                    // Set location fields and move map pin
                                    latitudeInput.value = lat;
                                    longitudeInput.value = lng;
                                    coordsDisplay.textContent = `Lat: ${lat.toFixed(5)}, Lon: ${lng.toFixed(5)}`;
                                    if (typeof map !== "undefined" && typeof marker !== "undefined") {
                                        map.setView([lat, lng], 17);
                                        if (!marker) {
                                            marker = L.marker([lat, lng], { draggable: true }).addTo(map);
                                            marker.on('dragend', (event) => {
                                                const position = marker.getLatLng();
                                                updateLocationDetails(position.lat, position.lng);
                                            });
                                        } else {
                                            marker.setLatLng([lat, lng]);
                                        }
                                    }
                                    // Reverse geocode to fill address
                                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                                        .then(resp => resp.json())
                                        .then(data => {
                                            if (data && data.display_name) {
                                                fullAddressInput.value = data.display_name;
                                                selectedAddressDiv.textContent = `Selected: ${data.display_name}`;
                                            }
                                        });
                                    fetchNearbyIssues(lat, lng);
                                } else {
                                    // No EXIF GPS found, try geolocation if not already tried
                                    if (!triedGeolocation) {
                                        triedGeolocation = true;
                                        if (navigator.geolocation) {
                                            navigator.geolocation.getCurrentPosition(
                                                function(position) {
                                                    const lat = position.coords.latitude;
                                                    const lng = position.coords.longitude;
                                                    latitudeInput.value = lat;
                                                    longitudeInput.value = lng;
                                                    coordsDisplay.textContent = `Lat: ${lat.toFixed(5)}, Lon: ${lng.toFixed(5)}`;
                                                    if (typeof map !== "undefined") {
                                                        map.setView([lat, lng], 17);
                                                        if (!marker) {
                                                            marker = L.marker([lat, lng], { draggable: true }).addTo(map);
                                                            marker.on('dragend', (event) => {
                                                                const position = marker.getLatLng();
                                                                updateLocationDetails(position.lat, position.lng);
                                                            });
                                                        } else {
                                                            marker.setLatLng([lat, lng]);
                                                        }
                                                    }
                                                    // Reverse geocode to fill address
                                                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                                                        .then(resp => resp.json())
                                                        .then(data => {
                                                            if (data && data.display_name) {
                                                                fullAddressInput.value = data.display_name;
                                                                selectedAddressDiv.textContent = `Selected: ${data.display_name}`;
                                                            }
                                                        });
                                                    fetchNearbyIssues(lat, lng);
                                                },
                                                function(error) {
                                                    console.error("Geolocation error:", error);
                                                    showNotification('Could not determine device location.', 'error');
                                                }
                                            );
                                        } else {
                                            showNotification('Geolocation is not supported by this browser.', 'error');
                                        }
                                    }
                                }
                            });
                        } catch (err) {
                            // ignore EXIF errors, try geolocation if not already tried
                            if (!triedGeolocation) {
                                triedGeolocation = true;
                                if (navigator.geolocation) {
                                    navigator.geolocation.getCurrentPosition(
                                        function(position) {
                                            const lat = position.coords.latitude;
                                            const lng = position.coords.longitude;
                                            latitudeInput.value = lat;
                                            longitudeInput.value = lng;
                                            coordsDisplay.textContent = `Lat: ${lat.toFixed(5)}, Lon: ${lng.toFixed(5)}`;
                                            if (typeof map !== "undefined") {
                                                map.setView([lat, lng], 17);
                                                if (!marker) {
                                                    marker = L.marker([lat, lng], { draggable: true }).addTo(map);
                                                    marker.on('dragend', (event) => {
                                                        const position = marker.getLatLng();
                                                        updateLocationDetails(position.lat, position.lng);
                                                    });
                                                } else {
                                                    marker.setLatLng([lat, lng]);
                                                }
                                            }
                                            // Reverse geocode to fill address
                                            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                                                .then(resp => resp.json())
                                                .then(data => {
                                                    if (data && data.display_name) {
                                                        fullAddressInput.value = data.display_name;
                                                        selectedAddressDiv.textContent = `Selected: ${data.display_name}`;
                                                    }
                                                });
                                            fetchNearbyIssues(lat, lng);
                                        },
                                        function(error) {
                                            console.error("Geolocation error:", error);
                                            showNotification('Could not determine device location.', 'error');
                                        }
                                    );
                                } else {
                                    showNotification('Geolocation is not supported by this browser.', 'error');
                                }
                            }
                        }
                    };
                    exifReader.readAsArrayBuffer(file);
                }
            });
        }
        
        const summarizeNearbyIssues = () => {
             if (nearbyIssuesData.length === 0) {
                showNotification('No issues nearby to summarize.', 'info');
                return;
            }

            summarizeIssuesBtn.disabled = true;
            summarizeIssuesBtn.textContent = 'üß† Summarizing...';
            issuesSummaryDiv.innerHTML = '<div class="skeleton h-4 w-full mb-2"></div><div class="skeleton h-4 w-3/4"></div>';
            issuesSummaryDiv.classList.remove('hidden');

            // Mock Gemini API call for summary
            setTimeout(() => {
                const issueCounts = nearbyIssuesData.reduce((acc, issue) => {
                    acc[issue.category] = (acc[issue.category] || 0) + 1;
                    return acc;
                }, {});

                const totalIssues = nearbyIssuesData.length;
                const uniqueCategories = Object.keys(issueCounts).length;
                
                let summary = `Analysis of ${totalIssues} nearby issues reveals ${uniqueCategories} distinct problem categories. `;
                
                const sortedIssues = Object.entries(issueCounts).sort(([,a],[,b]) => b-a);

                if(sortedIssues.length > 0) {
                    summary += `The most prevalent issue is '${sortedIssues[0][0]}' with ${sortedIssues[0][1]} reported case(s). `;
                }
                if(sortedIssues.length > 1) {
                    summary += `This is followed by '${sortedIssues[1][0]}' with ${sortedIssues[1][1]} case(s). `;
                }

                const resolvedCount = nearbyIssuesData.filter(i => i.status === 'resolved').length;
                if(resolvedCount > 0) {
                    summary += `${resolvedCount} issue(s) in the vicinity have been marked as resolved.`
                } else {
                    summary += "It appears no issues in the immediate area have been resolved yet."
                }
                
                issuesSummaryDiv.textContent = summary;
                summarizeIssuesBtn.disabled = false;
                summarizeIssuesBtn.textContent = '‚ú® Summarize';
            }, 1500);
        };


        // --- AI Description Button Logic ---
        // Enable/disable AI button on load
        const generateDescBtn = document.getElementById('generateDescBtn');
        if (generateDescBtn) {
            generateDescBtn.disabled = true;
        }

        // AI generate button logic
        if (generateDescBtn) {
            generateDescBtn.addEventListener('click', async function() {
                if (!issuePhotoInput.files || issuePhotoInput.files.length === 0) {
                    showNotification('Please upload a photo to use AI description.', 'error');
                    return;
                }
                // UI: Show loading spinner and disable button
                const originalHTML = generateDescBtn.innerHTML;
                generateDescBtn.disabled = true;
                generateDescBtn.innerHTML = `<svg class="inline animate-spin mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg>Generating...`;
                const file = issuePhotoInput.files[0];
                const reader = new FileReader();
                reader.onload = async function(e) {
                    try {
                        const base64Data = e.target.result.split(',')[1];
                        // Debug logs
                        console.log('[AI Generate] Sent payload size:', base64Data.length);
                        let resp;
                        try {
                            resp = await fetch('https://city-hawk.onrender.com/analyze-image', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ image_data: base64Data })
                            });
                        } catch (err) {
                            console.error('[AI Generate] Network error:', err);
                            showNotification('Network error: ' + err.message, 'error');
                            throw err;
                        }
                        console.log('[AI Generate] Response status:', resp.status);
                        let respText = await resp.text();
                        console.log('[AI Generate] Raw response text:', respText);
                        let data;
                        try {
                            data = JSON.parse(respText);
                        } catch (e) {
                            console.error('[AI Generate] JSON parse error:', e);
                            data = null;
                        }
                        if (!resp.ok) {
                            showNotification(data && data.error ? data.error : 'Failed to get AI description', 'error');
                            return;
                        }
                        if (data && data.description) {
                            issueDescription.value = data.description;
                            showNotification('AI description generated!', 'success');
                        } else {
                            showNotification('AI did not return a description.', 'error');
                        }
                    } catch (err) {
                        console.error('[AI Generate] Error:', err);
                        showNotification('AI description failed: ' + (err && err.message ? err.message : err), 'error');
                    } finally {
                        generateDescBtn.disabled = false;
                        generateDescBtn.innerHTML = originalHTML;
                    }
                };
                reader.onerror = function(e) {
                    console.error('[AI Generate] FileReader error:', e);
                    showNotification('Could not read photo for AI analysis.', 'error');
                    generateDescBtn.disabled = false;
                    generateDescBtn.innerHTML = originalHTML;
                };
                reader.readAsDataURL(file);
            });
        }

        // --- EVENT LISTENERS ---
        // --- Save new report to localStorage with images and details ---
        if (reportForm) {
            reportForm.addEventListener("submit", (e) => {
                e.preventDefault();

                const issueCategory = selectedCategoryInput.value;
                const issueDescriptionVal = issueDescription.value.trim();
                const state = stateSelect.value;
                const district = districtSelect.value;
                const latitude = latitudeInput.value;
                const longitude = longitudeInput.value;
                // Validate required fields
                if (!issueCategory || !issueDescriptionVal || !state || !district || !latitude || !longitude) {
                    showNotification("Please fill all required fields before submitting.", "error");
                    return;
                }
                // Tracking ID with random 3-digit suffix for uniqueness
                const trackingId = `REP-${Date.now()}-${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`;
                // Prepare report object with updated schema for compatibility
                const report = {
                    trackingId: trackingId,
                    issueCategory: issueCategory,
                    issueDescription: issueDescriptionVal,
                    latitude: latitude,
                    longitude: longitude,
                    timestamp: Date.now(),
                    status: 'submitted',
                    photos: uploadedFiles.map(f => ({ name: f.name, dataUrl: f.dataUrl })) || [],
                    feedback: '',
                    rating: 0,
                    state: state,
                    district: district
                };
                // Load existing reports from localStorage (if any)
                let reportsArray = [];
                try {
                    const stored = localStorage.getItem("reports");
                    if (stored) {
                        reportsArray = JSON.parse(stored);
                        if (!Array.isArray(reportsArray)) reportsArray = [];
                    }
                } catch (err) {
                    reportsArray = [];
                }
                reportsArray.push(report);
                localStorage.setItem("reports", JSON.stringify(reportsArray));
                showNotification(`Report submitted successfully! Tracking ID: ${trackingId}. <a href="my_reports.html" class="underline ml-2">View My Reports</a>`, "success");
                // Clear form and preview
                reportForm.reset();
                photoPreview.innerHTML = "";
                uploadedFiles = [];
            });
        }

        fullAddressInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const query = fullAddressInput.value;
                if (!query) return;

                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    if (data && data.length > 0) {
                        const { lat, lon } = data[0];
                        map.setView([lat, lon], 17);
                        marker.setLatLng([lat, lon]);
                        updateLocationDetails(parseFloat(lat), parseFloat(lon));
                    } else {
                        showNotification('Address not found.', 'error');
                    }
                } catch (error) {
                    console.error('Geocoding failed:', error);
                    showNotification('Error finding address.', 'error');
                }
            }
        });

        issuePhotoInput.addEventListener('change', handlePhotoUpload);
        locateMeBtn.addEventListener('click', locateUser);
        resetMapBtn.addEventListener('click', () => initMap(INDIA_CENTER_COORDS, INDIA_WIDE_ZOOM));
        stateSelect.addEventListener('change', (e) => {
            populateDistricts(e.target.value);
            // Shift map to selected state center if available
            const stateName = e.target.value;
            if (stateName && stateDistrictData[stateName]) {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(stateName + ', India')}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data && data[0]) {
                            const { lat, lon } = data[0];
                            map.setView([parseFloat(lat), parseFloat(lon)], 7);
                            marker.setLatLng([parseFloat(lat), parseFloat(lon)]);
                            updateLocationDetails(parseFloat(lat), parseFloat(lon));
                        }
                    });
            }
        });
        // Add district change event to shift map to district
        districtSelect.addEventListener('change', (e) => {
            const stateName = stateSelect.value;
            const districtName = e.target.value;
            if (stateName && districtName) {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(districtName + ', ' + stateName + ', India')}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data && data[0]) {
                            const { lat, lon } = data[0];
                            map.setView([parseFloat(lat), parseFloat(lon)], 11);
                            marker.setLatLng([parseFloat(lat), parseFloat(lon)]);
                            updateLocationDetails(parseFloat(lat), parseFloat(lon));
                        }
                    });
            }
        });
        languageSelect.addEventListener('change', (e) => updateUIWithTranslations(e.target.value));
        summarizeIssuesBtn.addEventListener('click', summarizeNearbyIssues);
        // AI button removed, so no event listener for generateDescBtn
        issueButtons.forEach(button => {
            button.addEventListener('click', () => handleCategorySelect(button));
        });
        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            showNotification('Logging you out...', 'info');
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1000);
        });
        window.addEventListener('panToIssue', (e) => {
            if (map && e.detail) {
                map.flyTo([e.detail.lat, e.detail.lon], 16);
            }
        });

        // --- INITIALIZATION ---
        updateDateTime();
        setInterval(updateDateTime, 1000);
        populateStates();
        initMap(INDIA_CENTER_COORDS, INDIA_WIDE_ZOOM);
        locateUser(); // Attempt to find user's location on page load
        updateUIWithTranslations(languageSelect.value);

        // Removed code related to loading saved photos from localStorage.uploadedPhotos
    });
    // --- Enhanced generateDescriptionWithGemini function with randomized human-like samples ---
    async function generateDescriptionWithGemini() {
        const selectedCategory = selectedCategoryInput.value;
        if (!selectedCategory) {
            showNotification('Please select an issue category first.', 'error');
            return;
        }

        const descriptions = {
            "Potholes": [
                `The pothole on Main Street near the intersection with 4th Avenue has grown steadily over the past month. It now spans almost half the width of the lane, making it extremely difficult for vehicles, especially two-wheelers, to navigate safely. Several residents have reported tire punctures and damaged suspension systems due to the sharp edges of the hole. During heavy rains, the pothole fills with muddy water, making it invisible to unsuspecting motorists. The situation worsens at night when streetlights are dim, increasing the risk of accidents. Local shopkeepers have witnessed multiple near-misses, and an auto-rickshaw recently overturned while trying to avoid the pothole. Despite repeated complaints to the municipal office, no repair work has been initiated. The community is concerned about the safety of schoolchildren and elderly pedestrians who use this route daily. The damaged section also causes traffic jams during peak hours, as vehicles slow down to maneuver around the pothole. There is a growing sense of frustration among residents, who feel their concerns are being ignored. If left unattended, the pothole is likely to expand further, potentially causing serious accidents and further deterioration of the road surface. Immediate attention is required to prevent escalation of the problem. The area is a key route for emergency vehicles, and any delay in repairs could have severe consequences. Local businesses have also reported a decline in customers, as people avoid the area due to the poor road condition. Overall, this issue demands urgent intervention from the concerned authorities to restore safety and normalcy for all commuters.`,
                `There are multiple potholes scattered along Park Road, particularly between the bus depot and the community center. The largest of these is approximately two feet wide and several inches deep, causing significant discomfort to drivers and passengers alike. Motorcyclists have been observed swerving dangerously to avoid the holes, risking collisions with oncoming traffic. During the monsoon, the potholes collect stagnant water, which not only damages vehicles but also creates breeding grounds for mosquitoes. Local residents have attempted to fill the holes with bricks and debris, but these makeshift solutions are only temporary. Delivery drivers and cab operators have started refusing trips to this locality, citing damage to their vehicles. The poor condition of the road has also led to an increase in travel time for daily commuters. Parents are particularly worried about the safety of children who cross the road to reach the nearby school. Despite several requests made to the public works department, the potholes remain unaddressed. The community feels neglected and is demanding a permanent solution. If the current situation persists, it could lead to more severe accidents and further isolation of the neighborhood. The authorities are urged to conduct a thorough inspection and initiate repairs at the earliest possible opportunity.`,
                `On the stretch of Patel Nagar Road adjacent to the market, a series of deep potholes have developed over the last two months. The road surface is cracked and uneven, making it hazardous for both vehicles and pedestrians. Local shopkeepers report that delivery vans often get stuck or suffer damage while unloading goods. The potholes have also led to frequent waterlogging, especially after heavy rains, causing additional inconvenience. Several residents have slipped and fallen while walking, sustaining minor injuries. The problem is exacerbated by poor drainage in the area, which prevents water from draining away quickly. Complaints have been lodged with the municipal corporation, but no action has been taken so far. The community is concerned that the situation will worsen if not addressed before the next monsoon season. There is an urgent need for comprehensive road repairs and improved drainage to ensure the safety and well-being of all road users. The continued neglect of this issue is affecting the quality of life in the neighborhood and undermining public trust in local governance.`,
                `The pothole near the bus stop on College Road has become a major hazard for daily commuters. It is particularly dangerous for cyclists and motorcyclists, who risk losing control of their vehicles when passing over it. The hole has been present for over three weeks and has already caused several minor accidents. Local residents have placed warning signs and reflective tape around the area, but these measures are insufficient. The pothole also disrupts the flow of traffic, as vehicles slow down or swerve to avoid it, leading to congestion during rush hour. The problem has been reported multiple times through the city‚Äôs grievance portal, but there has been no response from the authorities. The community is urging the municipal department to prioritize repairs and ensure regular maintenance to prevent similar issues in the future. The safety of commuters, especially schoolchildren and elderly citizens, is at stake. Timely intervention is essential to restore normalcy and prevent further accidents.`,
                `A large and deep pothole has developed on the main access road to the residential colony, causing significant inconvenience to residents and visitors. The pothole is located just before the security gate, making it unavoidable for all vehicles entering or leaving the area. Several cars have suffered damage to their undercarriage and tires, resulting in costly repairs. The problem is aggravated during the rainy season, when the pothole fills with water and becomes invisible to drivers. The residents‚Äô association has repeatedly contacted the municipal office, but no action has been taken. Temporary attempts to fill the hole with gravel have been unsuccessful, as the material is quickly washed away. The community is frustrated by the lack of response and is demanding immediate repairs. The continued neglect of this issue is affecting the reputation of the colony and deterring potential homebuyers. The authorities are urged to address the problem promptly and implement a long-term solution to prevent recurrence.`,
                `The road leading to the local hospital has developed several potholes, posing a serious risk to ambulances and emergency vehicles. The uneven surface causes delays and discomfort for patients being transported. Hospital staff and visitors have also reported difficulties in accessing the facility, especially during heavy rainfall when the potholes fill with water. The situation is particularly concerning for elderly and disabled patients, who are more vulnerable to accidents. Complaints have been submitted to the health department and municipal authorities, but no action has been taken so far. The community is calling for urgent repairs to ensure safe and timely access to medical services. The continued neglect of this issue could have life-threatening consequences for patients in need of emergency care. The authorities are urged to prioritize repairs and ensure regular maintenance of critical infrastructure.`,
                `A cluster of potholes has formed on the service road adjacent to the highway, creating a dangerous situation for vehicles merging onto the main road. Several minor accidents have occurred as drivers swerve to avoid the holes, sometimes colliding with other vehicles. The problem is compounded by poor lighting in the area, making the potholes difficult to spot at night. Local businesses have reported a decline in customers, as people avoid the area due to the poor road condition. The issue has been raised at multiple community meetings, but no action has been taken by the authorities. The community is demanding immediate repairs and improved lighting to enhance safety for all road users. The continued neglect of this issue is affecting the local economy and endangering public safety.`,
                `The approach road to the railway station is riddled with potholes, causing significant delays for commuters and taxis. The uneven surface makes it difficult for vehicles to maintain a steady speed, leading to traffic jams during peak hours. Passengers have missed trains due to the slow-moving traffic and frequent breakdowns caused by the poor road condition. The situation is particularly challenging for elderly and disabled passengers, who face difficulties in accessing the station. Complaints have been submitted to the railway authorities and municipal corporation, but no action has been taken so far. The community is urging the authorities to coordinate efforts and initiate repairs without further delay. The continued neglect of this issue is undermining the efficiency of public transportation and causing widespread inconvenience.`,
                `A deep pothole has formed at the entrance to the local market, creating a tripping hazard for pedestrians and a risk of damage to vehicles. The problem is exacerbated by poor drainage, which causes water to accumulate in the pothole after every rainfall. Shopkeepers have reported a decline in foot traffic, as customers avoid the area due to the risk of accidents. Temporary attempts to fill the hole with sand and gravel have been unsuccessful, as the material is quickly washed away. The issue has been reported to the municipal office, but no action has been taken. The community is demanding immediate repairs and improved drainage to ensure the safety of all market visitors. The continued neglect of this issue is affecting local businesses and endangering public safety.`,
                `The main road connecting the village to the highway has developed several large potholes, making it difficult for buses and trucks to access the area. The poor road condition has led to increased transportation costs, as drivers are forced to take longer routes to avoid the potholes. The problem is particularly severe during the monsoon, when the potholes fill with water and become impassable. Farmers have reported delays in transporting their produce to market, resulting in financial losses. The issue has been raised with the local panchayat and district administration, but no action has been taken so far. The community is calling for urgent repairs to restore connectivity and support local livelihoods. The continued neglect of this issue is affecting the economic well-being of the village and undermining public trust in local governance.`
            ],
            "Garbage": [
                `There is a persistent problem of uncollected garbage at the corner of Market Lane and Station Road. The municipal waste bins have been overflowing for more than two weeks, and the surrounding area is littered with plastic bags, food waste, and other refuse. The stench is unbearable, especially during the afternoon heat, forcing nearby shopkeepers to keep their doors closed. Stray dogs and cows rummage through the garbage, scattering it further and posing health risks to residents. During the rainy season, the waste clogs the drains, leading to frequent waterlogging and the breeding of mosquitoes. Several residents have developed respiratory problems, which they attribute to the unsanitary conditions. Despite repeated complaints to the municipal office, the garbage remains uncollected. The situation is particularly concerning for children, who are exposed to the filth while playing nearby. The community is demanding immediate action to clear the garbage and implement a regular collection schedule. The continued neglect of this issue is affecting the quality of life in the neighborhood and undermining public health. The authorities are urged to address the problem promptly and ensure proper waste management practices are followed.`,
                `The garbage collection point near the community park has turned into an open dumping ground. Residents have reported that the bins are rarely emptied, and waste is often left to rot in the open. The foul smell permeates the entire area, making it difficult for people to enjoy the park or go for walks. Local shopkeepers have seen a decline in customers, as people avoid the area due to the unsanitary conditions. The accumulation of garbage has also attracted rodents and other pests, increasing the risk of disease transmission. Complaints have been lodged with the municipal authorities, but no action has been taken so far. The community is frustrated by the lack of response and is demanding immediate intervention. If the current situation persists, it could lead to a major public health crisis. The authorities are urged to implement regular waste collection and ensure proper disposal of garbage to restore cleanliness and hygiene in the area.`,
                `A large pile of garbage has accumulated on the footpath along School Road, blocking access for pedestrians and forcing them to walk on the busy street. The waste consists of household refuse, plastic bottles, and food scraps, which attract stray animals and create a breeding ground for flies and mosquitoes. During heavy rains, the garbage is washed into the drains, causing blockages and flooding in the area. Parents are particularly concerned about the safety of schoolchildren, who have to navigate the hazardous conditions every day. Despite repeated requests to the municipal office, the garbage remains uncollected. The community is demanding immediate action to clear the waste and implement measures to prevent recurrence. The continued neglect of this issue is affecting public safety and undermining the reputation of the neighborhood.`,
                `Garbage has not been collected from the residential colony for more than ten days, leading to a buildup of waste in the common areas. The stench is overwhelming, especially during the afternoon heat, and residents are unable to open their windows or use their balconies. The accumulation of garbage has attracted flies, cockroaches, and rodents, increasing the risk of disease transmission. Children are particularly vulnerable, as they play near the waste piles. The residents‚Äô association has contacted the municipal office multiple times, but no action has been taken. Temporary attempts to manage the waste have been unsuccessful, as the bins are too small to accommodate the volume of garbage generated. The community is demanding larger bins and more frequent collection to address the problem. The continued neglect of this issue is affecting the health and well-being of residents and undermining public trust in local governance.`,
                `The garbage dump near the bus stand has grown steadily over the past month, spilling onto the road and blocking access for commuters. The waste consists of plastic bags, food wrappers, and discarded household items, creating an eyesore and a health hazard. The stench is unbearable, especially during the afternoon heat, and passengers are forced to wait for buses in unsanitary conditions. Street vendors have reported a decline in sales, as customers avoid the area due to the filth. Complaints have been submitted to the municipal authorities, but no action has been taken so far. The community is demanding immediate clearance of the garbage and implementation of regular waste collection. The continued neglect of this issue is affecting public health and the efficiency of public transportation.`,
                `A large pile of garbage has accumulated at the entrance to the local market, creating a tripping hazard for pedestrians and a risk of disease transmission. The waste consists of food scraps, plastic containers, and discarded packaging, which attract stray animals and create a breeding ground for flies and mosquitoes. Shopkeepers have reported a decline in customers, as people avoid the area due to the unsanitary conditions. Temporary attempts to manage the waste have been unsuccessful, as the bins are too small to accommodate the volume of garbage generated. The issue has been reported to the municipal office, but no action has been taken. The community is demanding larger bins and more frequent collection to address the problem. The continued neglect of this issue is affecting local businesses and public health.`,
                `The garbage collection point near the hospital has turned into an open dumping ground, posing a serious risk to patients and staff. The waste consists of medical refuse, food scraps, and plastic containers, creating an eyesore and a health hazard. The stench is unbearable, especially during the afternoon heat, and patients are unable to rest or recover in peace. The accumulation of garbage has attracted flies, cockroaches, and rodents, increasing the risk of disease transmission. Complaints have been lodged with the hospital administration and municipal authorities, but no action has been taken so far. The community is demanding immediate clearance of the garbage and implementation of regular waste collection. The continued neglect of this issue is affecting patient care and public health.`,
                `Garbage has not been collected from the commercial complex for more than a week, leading to a buildup of waste in the parking lot and common areas. The stench is overwhelming, especially during the afternoon heat, and customers are unable to use the facilities comfortably. The accumulation of garbage has attracted flies, cockroaches, and rodents, increasing the risk of disease transmission. Shopkeepers have reported a decline in sales, as people avoid the area due to the unsanitary conditions. The management has contacted the municipal office multiple times, but no action has been taken. The community is demanding immediate clearance of the garbage and implementation of regular waste collection. The continued neglect of this issue is affecting business operations and public health.`,
                `A large pile of garbage has accumulated on the vacant plot next to the school, creating a health hazard for students and staff. The waste consists of household refuse, plastic bottles, and food scraps, which attract stray animals and create a breeding ground for flies and mosquitoes. During heavy rains, the garbage is washed into the drains, causing blockages and flooding in the area. The school administration has contacted the municipal office multiple times, but no action has been taken. The community is demanding immediate clearance of the garbage and implementation of regular waste collection. The continued neglect of this issue is affecting the health and safety of students and undermining public trust in local governance.`,
                `The garbage dump near the railway station has grown steadily over the past month, spilling onto the road and blocking access for commuters. The waste consists of plastic bags, food wrappers, and discarded household items, creating an eyesore and a health hazard. The stench is unbearable, especially during the afternoon heat, and passengers are forced to wait for trains in unsanitary conditions. Street vendors have reported a decline in sales, as customers avoid the area due to the filth. Complaints have been submitted to the municipal authorities, but no action has been taken so far. The community is demanding immediate clearance of the garbage and implementation of regular waste collection. The continued neglect of this issue is affecting public health and the efficiency of public transportation.`
            ],
            "Streetlights": [
                `The entire stretch of road from the main junction to the community park has been left in complete darkness for the past three weeks due to non-functional streetlights. Residents are afraid to step out after sunset, and there have been several reports of petty thefts and chain snatching in the area. The lack of lighting has also made it difficult for motorists to spot pedestrians and stray animals, increasing the risk of accidents. Shopkeepers are forced to close early, resulting in a loss of business. Schoolchildren returning from evening classes feel unsafe, and parents are worried about their safety. Despite repeated complaints to the electricity board, no action has been taken. Temporary measures, such as using torches and mobile phone lights, are insufficient. The community is demanding immediate repair of the streetlights to restore safety and normalcy in the area. The continued neglect of this issue is affecting the quality of life and undermining public trust in local governance.`,
                `Several streetlights along the busy market road have been flickering or completely non-functional for over two weeks. The darkness has emboldened anti-social elements, leading to an increase in incidents of vandalism and theft. Residents are afraid to walk or drive through the area after dark. Shopkeepers have reported a decline in sales, as customers avoid the market in the evening. The problem has been reported to the municipal office and the electricity board, but no action has been taken so far. The community is demanding immediate repair of the streetlights and regular maintenance to prevent recurrence. The continued neglect of this issue is affecting public safety and the local economy.`,
                `The streetlights on the main road leading to the hospital have been out of order for more than a month, making it difficult for ambulances and emergency vehicles to navigate safely at night. Patients and hospital staff are forced to walk in the dark, risking accidents and encounters with stray animals. The lack of lighting has also made the area a target for thieves and pickpockets. Complaints have been submitted to the hospital administration and the electricity board, but no action has been taken. The community is demanding immediate repair of the streetlights to ensure the safety of patients and staff. The continued neglect of this issue is affecting the efficiency of emergency services and public health.`,
                `The approach road to the railway station is poorly lit, with several streetlights non-functional for over a month. Commuters have reported difficulty in finding their way, especially during early morning and late-night hours. The darkness has also made the area a target for criminals, with several incidents of theft reported in recent weeks. The problem has been reported to the railway authorities and the municipal office, but no action has been taken so far. The community is demanding immediate repair of the streetlights and improved security measures. The continued neglect of this issue is affecting public safety and the efficiency of public transportation.`,
                `The streetlights in the residential colony have been malfunctioning for over two weeks, leaving the internal roads in darkness. Residents are afraid to step out after sunset, and children are unable to play outside in the evenings. The lack of lighting has also made it difficult for security guards to monitor the area, increasing the risk of theft and vandalism. The residents‚Äô association has contacted the electricity board multiple times, but no action has been taken. Temporary measures, such as using battery-operated lights, are insufficient. The community is demanding immediate repair of the streetlights and regular maintenance to ensure the safety of residents. The continued neglect of this issue is affecting the quality of life in the colony.`,
                `The streetlights along the main highway have been non-functional for more than a month, making it dangerous for motorists and pedestrians alike. The darkness has led to several accidents, as drivers are unable to spot obstacles and pedestrians in time. The problem is particularly severe during the rainy season, when visibility is further reduced. Complaints have been submitted to the highway authorities and the electricity board, but no action has been taken so far. The community is demanding immediate repair of the streetlights and improved road safety measures. The continued neglect of this issue is affecting public safety and the efficiency of transportation.`,
                `The streetlights on the road leading to the school have been out of order for over two weeks, making it difficult for students and teachers to commute safely. Parents are worried about the safety of their children, especially during early morning and late evening hours. The lack of lighting has also made the area a target for anti-social elements. The school administration has contacted the electricity board and the municipal office, but no action has been taken. The community is demanding immediate repair of the streetlights and regular maintenance to ensure the safety of students and staff. The continued neglect of this issue is affecting the quality of education and public safety.`,
                `Several streetlights in the commercial area have been flickering or non-functional for more than a month, creating an unsafe environment for shoppers and employees. The darkness has led to an increase in incidents of theft and vandalism. Shopkeepers have reported a decline in sales, as customers avoid the area in the evening. The problem has been reported to the municipal office and the electricity board, but no action has been taken so far. The community is demanding immediate repair of the streetlights and improved security measures. The continued neglect of this issue is affecting the local economy and public safety.`,
                `The streetlights on the service road adjacent to the highway have been non-functional for over three weeks, making it dangerous for vehicles merging onto the main road. The lack of lighting has led to several accidents, as drivers are unable to spot obstacles in time. The problem is compounded by poor road conditions and heavy traffic. Complaints have been submitted to the highway authorities and the electricity board, but no action has been taken so far. The community is demanding immediate repair of the streetlights and improved road safety measures. The continued neglect of this issue is affecting public safety and the efficiency of transportation.`,
                `The streetlights in the village have been out of order for more than a month, leaving the entire area in darkness after sunset. Residents are afraid to step out, and children are unable to play outside in the evenings. The lack of lighting has also made it difficult for security personnel to monitor the area, increasing the risk of theft and vandalism. The village council has contacted the electricity board multiple times, but no action has been taken. The community is demanding immediate repair of the streetlights and regular maintenance to ensure the safety of residents. The continued neglect of this issue is affecting the quality of life in the village and undermining public trust in local governance.`
            ],
            "Water Leak": [
                `A persistent water leak has been observed on the main road near the intersection with 2nd Avenue for over two weeks. Clean drinking water is continuously flowing from a cracked underground pipe, creating a large puddle that covers half the road. The constant flow has made the surface slippery, posing a risk to motorists and pedestrians. Several two-wheelers have skidded and fallen, resulting in minor injuries. The leak has also weakened the road surface, causing cracks and potholes to develop. Residents have reported a significant drop in water pressure at home, indicating a major loss of supply. Complaints have been lodged with the water supply department, but no action has been taken. The community is frustrated by the wastage of precious water and the risk of accidents. Immediate repairs are required to prevent further damage to the road and restore normal water supply. The continued neglect of this issue is affecting public safety and resource conservation.`,
                `A water pipe near the community park has been leaking for more than a month, resulting in the loss of thousands of liters of water every day. The leak has created a swampy area that attracts mosquitoes and other pests, increasing the risk of disease transmission. Children playing in the park are exposed to the unsanitary conditions, and parents are concerned about their health. The stagnant water also emits a foul odor, making it unpleasant for residents and visitors. Despite repeated complaints to the water supply department, the leak remains unaddressed. Temporary attempts to stem the flow have been unsuccessful, as the pipe is old and corroded. The community is demanding immediate replacement of the damaged section and regular maintenance to prevent recurrence. The continued neglect of this issue is affecting public health and resource conservation.`,
                `A major water leak has developed on the road leading to the hospital, causing continuous flooding and making it difficult for ambulances and emergency vehicles to access the facility. The leak has been present for over three weeks, and the constant flow of water has created potholes and cracks in the road surface. Patients and hospital staff have reported difficulties in commuting, especially during the rainy season when the flooding worsens. The hospital administration has contacted the water supply department and the municipal office, but no action has been taken so far. The community is demanding immediate repairs to restore safe access to the hospital and prevent further damage to the road. The continued neglect of this issue is affecting public health and the efficiency of emergency services.`,
                `A leaking water pipe near the school has been wasting clean water for more than ten days, creating a slippery surface that poses a risk to students and teachers. Several children have slipped and fallen while walking to school, sustaining minor injuries. The leak has also caused waterlogging in the surrounding area, making it difficult for vehicles to pass. The school administration has contacted the water supply department, but no action has been taken. The community is demanding immediate repairs to prevent accidents and conserve water. The continued neglect of this issue is affecting the safety of students and public resource management.`,
                `A water leak at the entrance to the residential colony has been present for over two weeks, causing inconvenience to residents and visitors. The constant flow of water has created a muddy patch that is difficult to navigate, especially for elderly and disabled individuals. The leak has also led to a drop in water pressure in nearby homes, making daily chores difficult. The residents‚Äô association has contacted the water supply department multiple times, but no action has been taken. Temporary attempts to stem the flow have been unsuccessful, as the pipe is old and corroded. The community is demanding immediate replacement of the damaged section and regular maintenance to prevent recurrence. The continued neglect of this issue is affecting the quality of life in the colony.`,
                `A water leak on the service road adjacent to the highway has been wasting clean water for more than a month, creating a slippery surface that poses a risk to motorists and pedestrians. The leak has also caused the road surface to deteriorate, leading to the formation of potholes and cracks. Several accidents have occurred as vehicles skid on the wet surface. Complaints have been submitted to the highway authorities and the water supply department, but no action has been taken so far. The community is demanding immediate repairs to prevent further damage and restore safety. The continued neglect of this issue is affecting public safety and resource conservation.`,
                `A major water leak has developed near the market, causing continuous flooding and making it difficult for shoppers and vendors to access the area. The leak has been present for over three weeks, and the constant flow of water has created potholes and cracks in the road surface. Shopkeepers have reported a decline in sales, as customers avoid the area due to the inconvenience. The issue has been reported to the municipal office and the water supply department, but no action has been taken. The community is demanding immediate repairs to restore normalcy and prevent further damage. The continued neglect of this issue is affecting local businesses and public health.`,
                `A leaking water pipe near the bus stand has been wasting clean water for more than ten days, creating a slippery surface that poses a risk to commuters. Several passengers have slipped and fallen while waiting for buses, sustaining minor injuries. The leak has also caused waterlogging in the surrounding area, making it difficult for vehicles to pass. The issue has been reported to the transport department and the water supply department, but no action has been taken. The community is demanding immediate repairs to prevent accidents and conserve water. The continued neglect of this issue is affecting public safety and resource management.`,
                `A water leak at the entrance to the commercial complex has been present for over two weeks, causing inconvenience to customers and employees. The constant flow of water has created a muddy patch that is difficult to navigate, especially for elderly and disabled individuals. The leak has also led to a drop in water pressure in nearby shops, making daily operations difficult. The management has contacted the water supply department multiple times, but no action has been taken. Temporary attempts to stem the flow have been unsuccessful, as the pipe is old and corroded. The community is demanding immediate replacement of the damaged section and regular maintenance to prevent recurrence. The continued neglect of this issue is affecting business operations and public resource management.`,
                `A water leak on the road leading to the village has been wasting clean water for more than a month, creating a slippery surface that poses a risk to motorists and pedestrians. The leak has also caused the road surface to deteriorate, leading to the formation of potholes and cracks. Several accidents have occurred as vehicles skid on the wet surface. Complaints have been submitted to the village council and the water supply department, but no action has been taken so far. The community is demanding immediate repairs to prevent further damage and restore safety. The continued neglect of this issue is affecting public safety and resource conservation.`
            ],
            "default": [
                `This civic issue has persisted for several months despite repeated complaints from residents and local businesses. The problem has gradually worsened, causing daily inconvenience and frustration for everyone in the area. Community members have organized meetings and submitted petitions to the authorities, but there has been little to no response or visible action. The lack of attention has led to a decline in morale, with many residents feeling neglected and powerless. The issue is affecting the quality of life and the smooth functioning of daily activities. People are concerned that if the problem continues to be ignored, it could lead to more serious consequences, including health and safety risks. The community is urging the authorities to take immediate and effective action to address the issue and restore normalcy. The continued neglect of this problem is eroding public trust in local governance and undermining the sense of community. Residents are hopeful that their voices will be heard and that a sustainable solution will be implemented soon.`,
                `Residents have been grappling with this issue for an extended period, and the situation shows no signs of improvement. The problem has disrupted daily routines, making it difficult for people to go about their lives comfortably. Multiple complaints have been lodged with the relevant authorities, but there has been no significant progress. The lack of communication and transparency from the officials has added to the frustration. Community members are beginning to lose faith in the system and are considering alternative ways to address the issue themselves. The continued inaction is not only affecting the immediate area but also setting a negative precedent for the handling of similar problems in the future. The community is calling for greater accountability and a prompt resolution to restore confidence in local governance.`,
                `This issue has been a source of constant annoyance for residents and visitors alike. The problem has been reported multiple times through various channels, including the city‚Äôs grievance portal and local helplines. Despite assurances from the authorities, no concrete steps have been taken to resolve the issue. The situation is particularly challenging for vulnerable groups, such as the elderly and children, who are more affected by the inconvenience. The community is demanding a transparent and timely response from the officials. The lack of action is affecting the reputation of the neighborhood and deterring potential investors and homebuyers. The authorities are urged to prioritize the issue and implement a lasting solution.`,
                `The ongoing issue has created a sense of helplessness among residents, who feel their concerns are being ignored by the authorities. The problem has escalated over time, causing widespread discomfort and dissatisfaction. Community members have organized awareness campaigns and reached out to local media to highlight the issue, but there has been no significant response. The lack of action is affecting the overall well-being of the community and undermining public trust in local governance. The community is urging the authorities to take immediate and effective action to address the problem and restore normalcy.`,
                `This long-standing issue has been a major source of frustration for residents and local businesses. The problem has disrupted daily activities and created an unsafe environment for everyone in the area. Multiple complaints have been submitted to the authorities, but there has been no visible progress. The community is demanding greater accountability and a transparent resolution process. The continued neglect of this issue is affecting the quality of life and eroding public trust in local governance. Residents are hopeful that their concerns will be addressed promptly and effectively.`,
                `The issue has persisted for several months, despite repeated complaints from residents and local organizations. The problem is affecting the smooth functioning of daily activities and creating unnecessary stress for everyone in the area. The lack of response from the authorities has led to a decline in morale and a sense of abandonment. The community is calling for immediate action to resolve the issue and prevent similar problems in the future. The continued neglect of this issue is undermining the sense of community and eroding public trust in local governance.`,
                `Residents have been dealing with this issue for an extended period, and the situation is only getting worse. The problem has been reported through various channels, but there has been no significant response from the authorities. The lack of communication and transparency has added to the frustration. Community members are beginning to lose faith in the system and are considering alternative ways to address the issue themselves. The continued inaction is affecting the overall well-being of the community and setting a negative precedent for the handling of similar problems in the future. The community is urging the authorities to take immediate and effective action to resolve the issue.`,
                `This issue has been a constant source of annoyance for residents and visitors. The problem has been reported multiple times, but there has been no visible progress. The lack of action is affecting the reputation of the neighborhood and deterring potential investors and homebuyers. The community is demanding a transparent and timely response from the authorities. The continued neglect of this issue is affecting the quality of life and eroding public trust in local governance. Residents are hopeful that their concerns will be addressed promptly and effectively.`,
                `The ongoing problem has created a sense of helplessness among residents, who feel their concerns are being ignored by the authorities. The issue has escalated over time, causing widespread discomfort and dissatisfaction. Community members have organized awareness campaigns and reached out to local media to highlight the problem, but there has been no significant response. The lack of action is affecting the overall well-being of the community and undermining public trust in local governance. The community is urging the authorities to take immediate and effective action to address the issue and restore normalcy.`,
                `This long-standing issue has been a major source of frustration for residents and local businesses. The problem has disrupted daily activities and created an unsafe environment for everyone in the area. Multiple complaints have been submitted to the authorities, but there has been no visible progress. The community is demanding greater accountability and a transparent resolution process. The continued neglect of this issue is affecting the quality of life and eroding public trust in local governance. Residents are hopeful that their concerns will be addressed promptly and effectively.`
            ]
        };

        let options = descriptions[selectedCategory] || descriptions["default"];
        const desc = options[Math.floor(Math.random() * options.length)];

        issueDescription.value = desc;
        showNotification('Sample description added!', 'success');
    }
    </script>

</body>
</html>

    
